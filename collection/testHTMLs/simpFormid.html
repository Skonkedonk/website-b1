<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormData with GraphQL</title>
</head>
<body>
    <form id="entryForm">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" required>

        <label for="file">Upload Image:</label>
        <input type="file" id="file" name="image" accept=".jpg, .jpeg, .png" required>

        <button type="submit">Submit</button>
    </form>

    <div id="output"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const formElement = document.getElementById('entryForm');

            if (formElement) {
                formElement.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    const formData = new FormData(formElement);

                    const operations = {
                        query: `
                            mutation uploadFile($title: String!, $file: Upload) {
                                uploadFile(title: $title, file: $file) {
                                    id
                                    title
                                    filePath
                                }
                            }
                        `,
                        variables: {
                            title: formData.get('title'),
                            file: null,  // The file will be mapped in the map object
                        }
                    };

                    const map = { '0': ['variables.file'] };

                    const data = new FormData();
                    data.append('operations', JSON.stringify(operations));
                    data.append('map', JSON.stringify(map));
                    data.append('0', formData.get('file'));

                    try {
                        const response = await fetch('http://127.0.0.1:4000/graphql', {
                            method: 'POST',
                            body: data,
                        });

                        if (!response.ok) {
                            throw new Error('Failed to upload file');
                        }

                        const result = await response.json();
                        document.getElementById('output').textContent = 'Upload successful! File path: ' + result.data.uploadFile.filePath;
                    } catch (error) {
                        console.error('Error during upload:', error);
                        document.getElementById('output').textContent = 'Upload failed';
                    }
                });
            } else {
                console.error("Form element not found");
            }
        });
    </script>
</body>
</html>
